---
title: "EldersAIR initial home/adult data work"
author: "Ethan Walker"
date: "Started 10 Feb 2020, Updated 20 Feb 2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(tidyverse)
library(readxl)
library(naniar)
library(lubridate)
library(zoo)
```


# Load, format, and save home and adult overview/demographic data 
```{r}
# Load files 
## Box location: Update Box location once final data loaded
np_adult_initial <- read_xlsx("Input/NP/np_adult_20200220.xlsx") %>% 
  rename_all(tolower) %>% 
  mutate(adult_id_num = as.factor(adultid),
         home_id = as.factor(homeid),
         adult_id_char = as.factor(id),
         hispanic = as.factor(hispanic),
         race = as.factor(race),
         gender = as.factor(gender),
         consent_date = ymd(consentdate),
         area = "NP") %>% 
  select(adult_id_num, home_id, area, adult_id_char, hispanic, race, gender, consent_date) %>% 
  arrange(adult_id_num)

## Box location: Update Box location once final data loaded
nn_adult_initial <- read_xlsx("Input/NN/nn_adult_20200220.xlsx") %>% 
  rename_all(tolower) %>% 
  mutate(adult_id_num = as.factor(adultid),
         home_id = as.factor(homeid),
         adult_id_char = as.factor(id),
         hispanic = as.factor(hispanic),
         race = as.factor(race),
         gender = as.factor(gender),
         consent_date = ymd(consentdate),
         area = "NN") %>% 
  select(adult_id_num, home_id, area, adult_id_char, hispanic, race, gender, consent_date) %>% 
  arrange(adult_id_num)

elders_adult <- rbind(np_adult_initial, nn_adult_initial)


## Box location: Update Box location once final data loaded
np_homewinter_initial <- read_xlsx("Input/NP/np_homewinter_20200220.xlsx") %>% 
  rename_all(tolower) %>% 
  separate(interventiontime, c("trash1", "intervention_time"), sep = " ", remove = FALSE) %>%
  separate(samplingtime, c("trash1", "sampling_time_1"), sep = " ", remove = FALSE) %>%
  separate(pickuptime, c("trash1", "pickup_time_1"), sep = " ", remove = FALSE) %>%
  separate(sampling2time, c("trash1", "sampling_time_2"), sep = " ", remove = FALSE) %>%
  separate(pickup2time, c("trash1", "pickup_time_2"), sep = " ", remove = FALSE) %>%
  mutate(home_id = as.factor(homeid),
         winter_id = as.factor(winterid),
         home_winter_id = as.factor(homewinterid),
         intervention_date = ymd(interventiondate),
         intervention_time = as.character(intervention_time),
         sampling_date_1 = ymd(samplingdate),
         sampling_time_1 = as.character(sampling_time_1),
         pickup_date_1 = ymd(pickupdate),
         pickup_time_1 = as.character(pickup_time_1),
         sampling_date_2 = ymd(sampling2date),
         sampling_time_2 = as.character(sampling_time_2),
         pickup_date_2 = ymd(pickup2date),
         pickup_time_2 = as.character(pickup_time_2),
         area = "NP") %>% 
  select(home_id, winter_id, home_winter_id, area, intervention_date, intervention_time,
         sampling_date_1, sampling_time_1, pickup_date_1, pickup_time_1,
         sampling_date_2, sampling_time_2, pickup_date_2, pickup_time_2) %>% 
  filter(!is.na(home_id)) %>% 
  arrange(home_id, winter_id)

## Box location: Update Box location once final data loaded
nn_homewinter_initial <- read_xlsx("Input/NN/nn_homewinter_20200220.xlsx") %>% 
  rename_all(tolower) %>% 
  separate(interventiontime, c("trash1", "intervention_time"), sep = " ", remove = FALSE) %>%
  separate(samplingtime, c("trash1", "sampling_time_1"), sep = " ", remove = FALSE) %>%
  separate(pickuptime, c("trash1", "pickup_time_1"), sep = " ", remove = FALSE) %>%
  separate(sampling2time, c("trash1", "sampling_time_2"), sep = " ", remove = FALSE) %>%
  separate(pickup2time, c("trash1", "pickup_time_2"), sep = " ", remove = FALSE) %>%
  mutate(home_id = as.factor(homeid),
         winter_id = as.factor(winterid),
         home_winter_id = as.factor(homewinterid),
         intervention_date = ymd(interventiondate),
         intervention_time = as.character(intervention_time),
         sampling_date_1 = ymd(samplingdate),
         sampling_time_1 = as.character(sampling_time_1),
         pickup_date_1 = ymd(pickupdate),
         pickup_time_1 = as.character(pickup_time_1),
         sampling_date_2 = ymd(sampling2date),
         sampling_time_2 = as.character(sampling_time_2),
         pickup_date_2 = ymd(pickup2date),
         pickup_time_2 = as.character(pickup_time_2),
         area = "NN") %>% 
  select(home_id, winter_id, home_winter_id, area, intervention_date, intervention_time,
         sampling_date_1, sampling_time_1, pickup_date_1, pickup_time_1,
         sampling_date_2, sampling_time_2, pickup_date_2, pickup_time_2) %>% 
  filter(!is.na(home_id)) %>% 
  arrange(home_id, winter_id)

elders_homewinter <- rbind(np_homewinter_initial, nn_homewinter_initial)


## Box location: Update Box location once final data loaded
np_home_initial <- read_xlsx("Input/NP/np_home_20200220.xlsx") %>% 
  rename_all(tolower) %>% 
  mutate(home_id = as.factor(homeid),
         home = as.factor(home),
         treatment = as.factor(txcondition),
         area = "NP") %>% 
  select(home_id, home, treatment, area)

## Box location: Update Box location once final data loaded
nn_home_initial <- read_xlsx("Input/NN/nn_home_20200220.xlsx") %>% 
  rename_all(tolower) %>% 
  mutate(home_id = as.factor(homeid),
         home = as.factor(home),
         treatment = as.factor(txcondition),
         area = "NN") %>% 
  select(home_id, home, treatment, area)

elders_home <- rbind(np_home_initial, nn_home_initial)
```


# Combine adult, home, homewinter files
```{r}
elders_ids_linked <- elders_homewinter %>% 
  left_join(elders_home, by = c("area", "home_id")) %>% 
  left_join(elders_adult, by = c("area", "home_id")) %>% 
  mutate(home = str_remove(home, "[_]"))
#write_rds(elders_ids_linked, "Output/elders_ids_linked.rds")
```


